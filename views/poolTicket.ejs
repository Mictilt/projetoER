<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UMa Farmácia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <%- include('./partials/Style')%>
    <%- include('./partials/Style_Faq')%>
    <%- include('./partials/Style_Tickets')%>

</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<body>
<% if (isAuthenticated){ %>
    <%- include('./partials/Base_Logged')%>
<%} else{%>
    <%-include('./partials/Base_Notlogged')%>
<%} %>
<main>
        <label class = "title">Seus tickets:</label>
        <div class="contentTicket">
        <div class = "ticketInfo">
        <div class="accordion paddingl" id="accordionExample">
        <div class="card widthcard">
        <% tickets.forEach(function(tickets) {%>
            <% if(tickets.User == user.id) {%>
                <div class="card-header colapse" id="heading<%=num%>">
                    <h2 class="m-0">
                        <button class="btn btn-link btn-block text-left collapsed faqcollapse" type="button" data-toggle="collapse" data-target="#collapse<%=num%>" aria-expanded="true" aria-controls="collapse<%=num%>">
                            <label class = "titleTicket">Titulo: <%=tickets.title %><span>&#8681;</span></label>
                        </button>
                    </h2>
                </div>
                <div id="collapse<%=num%>" class="collapse" aria-labelledby="heading<%=num%>" data-parent="#accordionExample">
                    <div class="card-body faqcollapse">
                        <label class = "description">Descrição : <%=tickets.description %></label><br>
                        <label class = "state" >Estado : <%= ((tickets.state == true) ? "fechado" : "aberto") %></label><br>
                        <label class = "answer">Resposta :</label><br>
                        <%tickets.answers.forEach(function(answer) {%>
                        <label class = "answers"><%=answer%></label><br>
                        <% });%>
                        <a href = "/tickets/ticketsEspecifico/<%=tickets._id%>"><button class = "buttonTicket">Responder ao Ticket</button></a>
                    </div>      
                </div>
            
            <%num = num + 1%>
            <% }%>
        <% });%>
    </div>
    </div>
    </div>
<div class ="link">
    <a <% if(!isAuthenticated) { %>style="display: none;" <%} %> class = "linkPool" href="/tickets"><button class ="buttonVisualizarTickets" id = "visualizarTickets"> Visualizar todos os tickets</button></a>
    <a class = "linkCreat" href="/tickets/criarTicket"><button class ="buttonVisualizarTickets" id = "criarTickets"> Criar Ticket</button></a>
</div>    
</div>
</main>
<%-include('./partials/Footer')%>
</body>
</html>